<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERF-App - Real-time 3D Coordinate Streaming</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="container">
        <!-- Info Panel -->
        <div id="info">
            <h3>üì° Live Coordinates</h3>
            <div id="coordinates">
                <div>X: <span id="coord-x">--</span></div>
                <div>Y: <span id="coord-y">--</span></div>
                <div>Z: <span id="coord-z">--</span></div>
                <div>Type: <span id="trajectory-type">--</span></div>
            </div>
            <div id="status" class="status-connecting">Connecting...</div>
        </div>

        <!-- Scoring Panel -->
        <div id="scoring-panel">
            <h3>üéØ Archery Scoring</h3>
            
            <div class="player-input-section">
                <div class="input-group">
                    <label for="player-name">Player Name:</label>
                    <input type="text" id="player-name" placeholder="Enter player name to start..." maxlength="50">
                </div>
                <button id="toggle-details" class="btn btn-toggle">Show Details</button>
            </div>
            
            <div id="scoring-details" class="scoring-details-section" style="display: none;">
                <div class="current-throw-section">
                    <h4>Current Round</h4>
                    <div class="throw-stats">
                        <div class="stat-item">
                            <span class="stat-label">Status:</span>
                            <span class="stat-value" id="throw-status">Waiting for player name</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Round Score:</span>
                            <span class="stat-value" id="current-score">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Distance:</span>
                            <span class="stat-value" id="closest-distance">--</span>
                        </div>
                    </div>
                </div>
                
                <div class="scoring-zones-section">
                    <h4>Scoring Zones</h4>
                    <div class="scoring-zones">
                        <div class="zone-item bullseye">
                            <span class="zone-color" style="background: #FFD700;"></span>
                            <span class="zone-name">Bullseye (‚â§2)</span>
                            <span class="zone-points">50 pts</span>
                        </div>
                        <div class="zone-item inner">
                            <span class="zone-color" style="background: #FF6B6B;"></span>
                            <span class="zone-name">Inner (‚â§5)</span>
                            <span class="zone-points">25 pts</span>
                        </div>
                        <div class="zone-item outer">
                            <span class="zone-color" style="background: #4ECDC4;"></span>
                            <span class="zone-name">Outer (‚â§10)</span>
                            <span class="zone-points">10 pts</span>
                        </div>
                        <div class="zone-item outer2">
                            <span class="zone-color" style="background: #9B59B6;"></span>
                            <span class="zone-name">Outer 2 (‚â§16)</span>
                            <span class="zone-points">5 pts</span>
                        </div>
                        <div class="zone-item outer3">
                            <span class="zone-color" style="background: #34495E;"></span>
                            <span class="zone-name">Outer 3 (‚â§22)</span>
                            <span class="zone-points">1 pt</span>
                        </div>
                        <div class="zone-item miss">
                            <span class="zone-color" style="background: #95A5A6;"></span>
                            <span class="zone-name">Miss (>22)</span>
                            <span class="zone-points">0 pts</span>
                        </div>
                    </div>
                </div>
                
                <div class="throw-controls">
                    <button id="clear-history" class="btn btn-secondary">Clear History</button>
                </div>
            </div>
        </div>

        <!-- Leaderboard Panel -->
        <div id="leaderboard-panel">
            <h3>üèÜ Leaderboard</h3>
            
            <!-- Top 3 Best Attempts -->
            <div class="top-attempts-section">
                <h4>ü•á Top 3 Attempts</h4>
                <div id="top-attempts-container">
                    <p class="no-attempts">No attempts yet</p>
                </div>
            </div>
            
            <!-- Session Stats -->
            <div class="session-stats-section">
                <h4>üìä Session Stats</h4>
                <div class="session-stats">
                    <div class="stat-item">
                        <span class="stat-label">Rounds:</span>
                        <span class="stat-value" id="throw-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Score:</span>
                        <span class="stat-value" id="session-score">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Best Round:</span>
                        <span class="stat-value" id="best-throw">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Bullseyes:</span>
                        <span class="stat-value" id="bullseye-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Avg Score:</span>
                        <span class="stat-value" id="average-distance">0.0</span>
                    </div>
                </div>
            </div>
            
            <!-- Recent Rounds -->
            <div class="recent-rounds-section">
                <h4>üìà Recent Rounds</h4>
                <div id="throw-history-container">
                    <p class="no-throws">No rounds completed yet</p>
                </div>
            </div>
            
            <div class="leaderboard-controls">
                <button id="show-full-leaderboard" class="btn btn-primary">Show Full Leaderboard</button>
                <button id="clear-attempts" class="btn btn-secondary">Clear All Attempts</button>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- OrbitControls for simple camera navigation -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- TransformControls for interactive object manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    
    <!-- Application Modules -->
    <script src="js/throw-manager.js"></script>
    <script src="js/scene-manager.js"></script>
    <script src="js/websocket-manager.js"></script>

    <script>
        // Application Initialization
        let sceneManager, throwManager, websocketManager;

        function init() {
            // Initialize managers
            sceneManager = new SceneManager();
            throwManager = new ThrowManager(sceneManager);
            websocketManager = new WebSocketManager(sceneManager, null, throwManager);
            
            // Make throwManager globally accessible for keyboard shortcuts
            window.throwManager = throwManager;

            // Handle window resize
            window.addEventListener('resize', () => {
                sceneManager.handleResize();
            });

            // Add keyboard shortcuts for throwing
            document.addEventListener('keydown', (event) => {
                if (event.ctrlKey || event.metaKey) {
                    switch(event.key) {
                        case 'c':
                            event.preventDefault();
                            throwManager.clearRoundHistory();
                            break;
                        case 'f':
                            event.preventDefault();
                            throwManager.forceEndThrow();
                            break;
                        case 'r':
                            event.preventDefault();
                            throwManager.forceEndRound();
                            break;
                        case 'p':
                            event.preventDefault();
                            throwManager.exportAttemptsLeaderboard();
                            break;
                        case 'g':
                            event.preventDefault();
                            sceneManager.downloadTargetPosition();
                            break;
                    }
                }
            });

            console.log('üöÄ GERF-App initialized successfully!');
            console.log('üéÆ Camera Controls:');
            console.log('  ‚Ä¢ Left Mouse: Orbit around scene');
            console.log('  ‚Ä¢ Right Mouse: Pan camera');
            console.log('  ‚Ä¢ Mouse Wheel: Zoom in/out');
            console.log('üéØ Scene Controls:');
            console.log('  ‚Ä¢ R: Reset camera position (or Rotate mode if target selected)');
            console.log('  ‚Ä¢ S: Toggle starfield (or Scale mode if target selected)');
            console.log('  ‚Ä¢ Z: Toggle scoring zone indicators');
            console.log('  ‚Ä¢ X: Clear visual indicators');
            console.log('  ‚Ä¢ V: Toggle trajectory tracking (manual)');
            console.log('  ‚Ä¢ C: Clear trajectory trail');
            console.log('  ‚Ä¢ L: Show leaderboard');
            console.log('üéØ Target Transform:');
            console.log('  ‚Ä¢ Click target to select for transformation');
            console.log('  ‚Ä¢ T: Translate mode (move target)');
            console.log('  ‚Ä¢ R: Rotate mode (rotate target)');
            console.log('  ‚Ä¢ S: Scale mode (uniform scaling - maintains proportions)');
            console.log('  ‚Ä¢ Delete/Backspace: Reset target to default position');
            console.log('  ‚Ä¢ Click elsewhere to deselect');
            console.log('üéØ Axis Colors (Local Mode):');
            console.log('  ‚Ä¢ Red Arrow = Target\'s Local X-axis');
            console.log('  ‚Ä¢ Green Arrow = Target\'s Local Y-axis');
            console.log('  ‚Ä¢ Blue Arrow = Target\'s Local Z-axis');
            console.log('  ‚Ä¢ (Arrows follow target orientation)');
            console.log('üíæ Target Settings:');
            console.log('  ‚Ä¢ Position, rotation, and scale are automatically saved');
            console.log('  ‚Ä¢ Settings reload automatically on app startup');
            console.log('üéØ 3-Throw Round System:');
            console.log('  ‚Ä¢ Enter player name to start 3-throw round');
            console.log('  ‚Ä¢ System automatically tracks throws and scores');
            console.log('  ‚Ä¢ Round completes after 3 throws, ready for next player');
            console.log('  ‚Ä¢ Same names allowed - each round is individual attempt');
            console.log('üéØ Data Controls:');
            console.log('  ‚Ä¢ Ctrl+C: Clear round history');
            console.log('  ‚Ä¢ Ctrl+F: Force end current throw');
            console.log('  ‚Ä¢ Ctrl+R: Force end current round');
            console.log('  ‚Ä¢ Ctrl+P: Export complete leaderboard data');
            console.log('  ‚Ä¢ Ctrl+G: Download current target position (for server)');
            console.log('üìä Scoring: Individual attempts leaderboard, automatic detection and scoring');
        }

        // Initialize the application when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>